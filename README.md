# wnf
Follow my WealthNavi transactions and trade via SBI

# 目的
WealthNavi を参考に、SBI証券を通じて倍率に応じた個人取引を実行する。
長期的投資に特化し、倍率変更、リバランス、DeTAXの目的以外の売却は行わない。

# 基礎データ
## WealthNavi ポートフォリオ
日次でWealthNavi上のポートフォリオを`wn_portfolio*`表に格納する。銘柄価格、銘柄口数は含まれない。

## WealthNavi トランザクション
日次でWealthNaviで新たに記録された取引情報の有無を確認する。取引情報がある場合は`wn_history*`表に格納する。

## 倍率
`FACTOR`環境変数及び`sbi_portfolio`表に格納する。

## SBI証券 ポートフォリオ
日次でSBI証券上のポートフォリオを`sbi_portfolio*`表に格納する。銘柄価格、銘柄口数が含まれる。`wn_portfolio`表に含まれる銘柄全てが対象となる。
SBIのポートフォリオには海外ETFのみを格納する。判定としては、銘柄情報にアクセスし、「ETF情報」が存在するかどうかが条件となる。

## 取引
以下のルールで取引を行う。
- 当日のポートフォリオ、または購入があった場合にその差分金額を前日のポートフォリオに足したものの大きな方を用い、SBI証券側の口数がWealthNavi側の口数(銘柄USDをSBI証券から得た銘柄価格で除したもの)に比して0.5口以上少なければ、小数点切り上げで同一口数となるように購入する。売却は行わない。
- リバランスがあった場合に、売却された差分金額を前日のポートフォリオから減じたものを用い、SBI証券側の口数がWealthNavi側の口数と1口未満になるように売却する(購入については前項の操作で実施される)。
- DeTAXがあった場合に。当該銘柄が10%単位で何口売却/購入を行ったかを計算し、同%のSBI証券側の売却/購入を実施する。








