# wnf

WealthNavi Follower

## できること

本プログラムは、自身の WealthNavi を参考にしながら、SBI証券サイトを通じて倍率に応じた個人取引を実行します。
具体的には、WealthNavi の資産量を下回ることのないようにSBI証券にて購入のみを実施します。

### やらないこと

売却には対応していません。例えばリバランスが発生した場合には、購入のみ実施され、売却はされません。また、自身で WealthNavi の引き出しを行った場合にも売却はされません。いずれの場合も、必要に応じて自身で売却を行う必要があります。

## アーキテクチャ

本プログラムは、AWS Systems Manager - Parameter Store に環境情報を配置し、Amazon S3 と Amazon ECS上のコンテナにて動作し、Slack と連携することを前提としています。

## データ

sqlite データベースを S3 に保存し、実行時に更新し、正常終了時に S3 上に書き戻します。

### データベーススキーマ

| テーブル名 | 役割 | 備考 |
| -------- | ---- | ---- |
| wn_portfolio | 日次でのWealthNavi上のポートフォリオ | 銘柄価格、銘柄口数は含まれない。 |
| wn_history | 日次でのWealthNaviでの取引情報 | - |
| sbi_portfolio | SBI証券上のポートフォリオ | 銘柄価格、銘柄口数が含まれる。海外ETF(*)のみを格納。 |

#### (*)海外ETFかどうかの判定方法

銘柄情報に「ETF情報」が存在するかどうかで判定しています。

## 備考

### 未成立の取引の扱い

購入したものの、為替や株価が上昇し、取引が未成立となることがあります。未成立の取引が存在したまま再度購入が実施されると、再度当該金額の入金が必要となってしまいますので、購入実施時には未成立の取引をすべてキャンセルした上で改めて必要な購入を実施します。

### 重要な情報が存在する場合について

WealthNavi も SBI証券も、重要な情報の存在時には確認した旨の操作を行わない限りログインが完了しません。本プログラムでは Slack に当該情報を連携して確認させ、プログラム内で確認して処理を続行します。

## テスト方法


```
export $(cat test.env) && ./run.sh 
```














